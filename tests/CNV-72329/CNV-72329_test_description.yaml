document_metadata:
  std_version: 2.1-enhanced
  generated_date: '2026-02-04'
  jira_issue: CNV-72329
  jira_summary: Support changing the VM attached network NAD ref using hotplug
  parent_epic: VIRTSTRAT-560
  stp_reference:
    file: examples/CNV-72329/CNV-72329_test_plan.md
    version: v1
    sections_covered: Section III - Test Scenarios
  related_prs:
  - repo: kubevirt/enhancements
    pr_number: 138
    url: https://github.com/kubevirt/enhancements/pull/138
    title: 'VEP 140: Live Update NetworkAttachmentDefinition Reference'
    merged: true
  owning_sig: sig-network
  participating_sigs:
  - sig-network
  - sig-compute
  target_version: CNV v4.22.0
  feature_gate: LiveUpdateNADRef
  total_scenarios: 57
  tier_1_count: 17
  tier_2_count: 22
  negative_count: 10
  platform_count: 8
  p0_count: 10
  p1_count: 22
  p2_count: 23
  p3_count: 2
code_generation_config:
  std_version: 2.1-enhanced
  framework: ginkgo-v2
  assertion_library: gomega
  language: go
  package_name: network
  context_init:
  - statement: ctx := context.Background()
    variable: ctx
    type: context.Context
  - statement: namespace := testsuite.GetTestNamespace(nil)
    variable: namespace
    type: string
  imports:
    dot_imports:
    - github.com/onsi/ginkgo/v2
    - github.com/onsi/gomega
    standard:
    - context
    - time
    k8s_core:
    - path: k8s.io/api/core/v1
      alias: k8sv1
    - path: k8s.io/apimachinery/pkg/apis/meta/v1
      alias: metav1
    kubevirt_base:
    - kubevirt.io/kubevirt/tests/decorators
    - kubevirt.io/kubevirt/tests/framework/kubevirt
    - kubevirt.io/kubevirt/tests/testsuite
    - kubevirt.io/kubevirt/tests/libvmi
    kubevirt_api:
    - path: kubevirt.io/api/core/v1
      alias: v1
    network:
    - path: github.com/k8snetworkplumbingwg/network-attachment-definition-client/pkg/apis/k8s.cni.cncf.io/v1
      alias: networkv1
  timeout_constants:
    tiny: StartupTimeoutSecondsTiny
    small: StartupTimeoutSecondsSmall
    medium: StartupTimeoutSecondsMedium
    large: StartupTimeoutSecondsLarge
    xlarge: StartupTimeoutSecondsXLarge
    huge: StartupTimeoutSecondsHuge
    xhuge: StartupTimeoutSecondsXHuge
  migration_timeout: MigrationWaitTime
  helper_library_imports:
    libvmifact: kubevirt.io/kubevirt/tests/libvmifact
    libnet: kubevirt.io/kubevirt/tests/libnet
    libwait: kubevirt.io/kubevirt/tests/libwait
    libpod: kubevirt.io/kubevirt/tests/libpod
    libvmops: kubevirt.io/kubevirt/tests/libvmops
    libmigration: kubevirt.io/kubevirt/tests/libmigration
common_preconditions:
  infrastructure:
  - name: OpenShift cluster
    requirement: OCP 4.22+ with OVN-Kubernetes
    validation: oc version
  - name: OpenShift Virtualization
    requirement: CNV v4.22.0+
    validation: oc get csv -n openshift-cnv | grep kubevirt-hyperconverged
  - name: Multus CNI
    requirement: Multus installed and configured
    validation: oc get ds multus -n kube-system
  - name: Live migration support
    requirement: Minimum 3 worker nodes for live migration
    validation: oc get nodes --no-headers | wc -l
  operators:
  - name: HyperConverged Cluster Operator
    namespace: openshift-cnv
    validation: oc get csv -n openshift-cnv | grep kubevirt-hyperconverged
  cluster_configuration:
    topology: Multi-node
    cpu_virtualization: Standard
    storage: Any StorageClass with RWX support
    network: OVN-Kubernetes
  feature_gates:
  - name: LiveUpdateNADRef
    enabled: true
    validation: Check HyperConverged CR for LiveUpdateNADRef feature gate
  rbac_requirements:
  - permission: create, get, list, delete on VirtualMachines
    scope: 'Namespace: test namespace'
    validation: oc auth can-i create virtualmachines
  - permission: create, get, list, delete on NetworkAttachmentDefinitions
    scope: 'Namespace: test namespace'
    validation: oc auth can-i create network-attachment-definitions
scenarios:
- scenario_id: T1.1
  test_id: TS-CNV-72329-001
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD reference on running VM with bridge binding
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm migrates to new pod with updated nad, interface properties preserved
      test_id_format: '[test_id:TS-CNV-72329-001]'
  test_objective:
    title: Change NAD reference on running VM with bridge binding
    what: Validate that change nad reference on running vm with bridge binding. VM migrates to new pod with updated NAD, interface
      properties preserved
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM migrates to new pod with updated NAD, interface properties preserved
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM migrates to new pod with updated NAD, interface properties preserved
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM migrates to new pod with updated NAD, interface properties preserved
    condition: 'Expected: VM migrates to new pod with updated NAD, interface properties preserved'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.2
  test_id: TS-CNV-72329-002
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-connectivity-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify network connectivity after NAD swap
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm has connectivity through new network attachment
      test_id_format: '[test_id:TS-CNV-72329-002]'
  test_objective:
    title: Verify network connectivity after NAD swap
    what: Validate that verify network connectivity after nad swap. VM has connectivity through new network attachment
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM has connectivity through new network attachment
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM has connectivity through new network attachment
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM has connectivity through new network attachment
    condition: 'Expected: VM has connectivity through new network attachment'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.3
  test_id: TS-CNV-72329-003
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: feature-gate-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Enable LiveUpdateNADRef feature gate
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature gate enables successfully, feature is active
      test_id_format: '[test_id:TS-CNV-72329-003]'
  test_objective:
    title: Enable LiveUpdateNADRef feature gate
    what: Validate that enable liveupdatenadref feature gate. Feature gate enables successfully, feature is active
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature gate enables successfully, feature is active
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature gate enables successfully, feature is active
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: Feature gate enables successfully, feature is active
    condition: 'Expected: Feature gate enables successfully, feature is active'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.4
  test_id: TS-CNV-72329-004
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD to different VLAN ID
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm connects to new vlan post-migration
      test_id_format: '[test_id:TS-CNV-72329-004]'
  test_objective:
    title: Change NAD to different VLAN ID
    what: Validate that change nad to different vlan id. VM connects to new VLAN post-migration
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM connects to new VLAN post-migration
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM connects to new VLAN post-migration
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM connects to new VLAN post-migration
    condition: 'Expected: VM connects to new VLAN post-migration'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.5
  test_id: TS-CNV-72329-005
  tier: Tier 1
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify VMI network spec sync from VM
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vmi spec reflects vm network changes before migration
      test_id_format: '[test_id:TS-CNV-72329-005]'
  test_objective:
    title: Verify VMI network spec sync from VM
    what: Validate that verify vmi network spec sync from vm. VMI spec reflects VM network changes before migration
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VMI spec reflects VM network changes before migration
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VMI spec reflects VM network changes before migration
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: VMI spec reflects VM network changes before migration
    condition: 'Expected: VMI spec reflects VM network changes before migration'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.6
  test_id: TS-CNV-72329-006
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify RestartRequired condition not added
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm does not get restartrequired condition for nad-only change
      test_id_format: '[test_id:TS-CNV-72329-006]'
  test_objective:
    title: Verify RestartRequired condition not added
    what: Validate that verify restartrequired condition not added. VM does not get RestartRequired condition for NAD-only
      change
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM does not get RestartRequired condition for NAD-only change
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM does not get RestartRequired condition for NAD-only change
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM does not get RestartRequired condition for NAD-only change
    condition: 'Expected: VM does not get RestartRequired condition for NAD-only change'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.7
  test_id: TS-CNV-72329-007
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify immediate migration trigger
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should workloadupdatecontroller triggers migration immediately for bridge binding
      test_id_format: '[test_id:TS-CNV-72329-007]'
  test_objective:
    title: Verify immediate migration trigger
    what: Validate that verify immediate migration trigger. WorkloadUpdateController triggers migration immediately for bridge
      binding
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - WorkloadUpdateController triggers migration immediately for bridge binding
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: WorkloadUpdateController triggers migration immediately for bridge binding
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: WorkloadUpdateController triggers migration immediately for bridge binding
    condition: 'Expected: WorkloadUpdateController triggers migration immediately for bridge binding'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.8
  test_id: TS-CNV-72329-008
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Preserve MAC address after NAD swap
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm interface retains original mac address post-migration
      test_id_format: '[test_id:TS-CNV-72329-008]'
  test_objective:
    title: Preserve MAC address after NAD swap
    what: Validate that preserve mac address after nad swap. VM interface retains original MAC address post-migration
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM interface retains original MAC address post-migration
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM interface retains original MAC address post-migration
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM interface retains original MAC address post-migration
    condition: 'Expected: VM interface retains original MAC address post-migration'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.9
  test_id: TS-CNV-72329-009
  tier: Tier 1
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Preserve interface name after NAD swap
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm interface retains original name (e.g., net1) post-migration
      test_id_format: '[test_id:TS-CNV-72329-009]'
  test_objective:
    title: Preserve interface name after NAD swap
    what: Validate that preserve interface name after nad swap. VM interface retains original name (e.g., net1) post-migration
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM interface retains original name (e.g., net1) post-migration
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM interface retains original name (e.g., net1) post-migration
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: VM interface retains original name (e.g., net1) post-migration
    condition: 'Expected: VM interface retains original name (e.g., net1) post-migration'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.10
  test_id: TS-CNV-72329-010
  tier: Tier 1
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD between same-type networks
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should swap from bridge-based nad a to bridge-based nad b succeeds
      test_id_format: '[test_id:TS-CNV-72329-010]'
  test_objective:
    title: Change NAD between same-type networks
    what: Validate that change nad between same-type networks. Swap from bridge-based NAD A to bridge-based NAD B succeeds
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Swap from bridge-based NAD A to bridge-based NAD B succeeds
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Swap from bridge-based NAD A to bridge-based NAD B succeeds
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Swap from bridge-based NAD A to bridge-based NAD B succeeds
    condition: 'Expected: Swap from bridge-based NAD A to bridge-based NAD B succeeds'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.11
  test_id: TS-CNV-72329-011
  tier: Tier 1
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify target pod multus annotation
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should target pod has updated multus annotation with new nad reference
      test_id_format: '[test_id:TS-CNV-72329-011]'
  test_objective:
    title: Verify target pod multus annotation
    what: Validate that verify target pod multus annotation. Target pod has updated multus annotation with new NAD reference
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Target pod has updated multus annotation with new NAD reference
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Target pod has updated multus annotation with new NAD reference
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Target pod has updated multus annotation with new NAD reference
    condition: 'Expected: Target pod has updated multus annotation with new NAD reference'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.12
  test_id: TS-CNV-72329-012
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Basic NAD swap with single secondary interface
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm with one secondary interface swaps nad successfully
      test_id_format: '[test_id:TS-CNV-72329-012]'
  test_objective:
    title: Basic NAD swap with single secondary interface
    what: Validate that basic nad swap with single secondary interface. VM with one secondary interface swaps NAD successfully
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM with one secondary interface swaps NAD successfully
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM with one secondary interface swaps NAD successfully
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM with one secondary interface swaps NAD successfully
    condition: 'Expected: VM with one secondary interface swaps NAD successfully'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.13
  test_id: TS-CNV-72329-013
  tier: Tier 1
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: migration-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify VM remains running during migration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm does not restart, only migrates
      test_id_format: '[test_id:TS-CNV-72329-013]'
  test_objective:
    title: Verify VM remains running during migration
    what: Validate that verify vm remains running during migration. VM does not restart, only migrates
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM does not restart, only migrates
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM does not restart, only migrates
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: VM does not restart, only migrates
    condition: 'Expected: VM does not restart, only migrates'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.14
  test_id: TS-CNV-72329-014
  tier: Tier 1
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: migration-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Check VMI conditions post-migration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vmi has no error conditions after successful nad swap
      test_id_format: '[test_id:TS-CNV-72329-014]'
  test_objective:
    title: Check VMI conditions post-migration
    what: Validate that check vmi conditions post-migration. VMI has no error conditions after successful NAD swap
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VMI has no error conditions after successful NAD swap
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VMI has no error conditions after successful NAD swap
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: VMI has no error conditions after successful NAD swap
    condition: 'Expected: VMI has no error conditions after successful NAD swap'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T1.15
  test_id: TS-CNV-72329-015
  tier: Tier 1
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify VM events logged correctly
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm events include nad change and migration trigger
      test_id_format: '[test_id:TS-CNV-72329-015]'
  test_objective:
    title: Verify VM events logged correctly
    what: Validate that verify vm events logged correctly. VM events include NAD change and migration trigger
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM events include NAD change and migration trigger
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM events include NAD change and migration trigger
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: VM events include NAD change and migration trigger
    condition: 'Expected: VM events include NAD change and migration trigger'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 5 minutes
- scenario_id: T2.1
  test_id: TS-CNV-72329-016
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: feature-gate-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Disable LiveUpdateNADRef feature gate
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should nad change requires restartrequired condition
      test_id_format: '[test_id:TS-CNV-72329-016]'
  test_objective:
    title: Disable LiveUpdateNADRef feature gate
    what: Validate that disable liveupdatenadref feature gate. NAD change requires RestartRequired condition
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - NAD change requires RestartRequired condition
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: NAD change requires RestartRequired condition
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: NAD change requires RestartRequired condition
    condition: 'Expected: NAD change requires RestartRequired condition'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.2
  test_id: TS-CNV-72329-017
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: feature-gate-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD when feature gate disabled
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm gets restartrequired condition, no migration triggered
      test_id_format: '[test_id:TS-CNV-72329-017]'
  test_objective:
    title: Change NAD when feature gate disabled
    what: Validate that change nad when feature gate disabled. VM gets RestartRequired condition, no migration triggered
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM gets RestartRequired condition, no migration triggered
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM gets RestartRequired condition, no migration triggered
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: VM gets RestartRequired condition, no migration triggered
    condition: 'Expected: VM gets RestartRequired condition, no migration triggered'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.3
  test_id: TS-CNV-72329-018
  tier: Tier 2
  priority: P2
  mvp: false
  automated: Partial
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Multiple NAD reference changes before migration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should last nad reference is used for target pod
      test_id_format: '[test_id:TS-CNV-72329-018]'
  test_objective:
    title: Multiple NAD reference changes before migration
    what: Validate that multiple nad reference changes before migration. Last NAD reference is used for target pod
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Last NAD reference is used for target pod
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Last NAD reference is used for target pod
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Last NAD reference is used for target pod
    condition: 'Expected: Last NAD reference is used for target pod'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.4
  test_id: TS-CNV-72329-019
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD to non-existent network
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should migration fails with clear error, vm remains on source
      test_id_format: '[test_id:TS-CNV-72329-019]'
  test_objective:
    title: Change NAD to non-existent network
    what: Validate that change nad to non-existent network. Migration fails with clear error, VM remains on source
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Migration fails with clear error, VM remains on source
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Migration fails with clear error, VM remains on source
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Migration fails with clear error, VM remains on source
    condition: 'Expected: Migration fails with clear error, VM remains on source'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.5
  test_id: TS-CNV-72329-020
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with multiple secondary interfaces
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should only specified interface nad changes, others unchanged
      test_id_format: '[test_id:TS-CNV-72329-020]'
  test_objective:
    title: NAD swap with multiple secondary interfaces
    what: Validate that nad swap with multiple secondary interfaces. Only specified interface NAD changes, others unchanged
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Only specified interface NAD changes, others unchanged
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Only specified interface NAD changes, others unchanged
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Only specified interface NAD changes, others unchanged
    condition: 'Expected: Only specified interface NAD changes, others unchanged'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.6
  test_id: TS-CNV-72329-021
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change multiple NAD references simultaneously
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should all interfaces migrate with updated nad references
      test_id_format: '[test_id:TS-CNV-72329-021]'
  test_objective:
    title: Change multiple NAD references simultaneously
    what: Validate that change multiple nad references simultaneously. All interfaces migrate with updated NAD references
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - All interfaces migrate with updated NAD references
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: All interfaces migrate with updated NAD references
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: All interfaces migrate with updated NAD references
    condition: 'Expected: All interfaces migrate with updated NAD references'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.7
  test_id: TS-CNV-72329-022
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap on VM with hotplugged interface
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should previously hotplugged interface swaps nad successfully
      test_id_format: '[test_id:TS-CNV-72329-022]'
  test_objective:
    title: NAD swap on VM with hotplugged interface
    what: Validate that nad swap on vm with hotplugged interface. Previously hotplugged interface swaps NAD successfully
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Previously hotplugged interface swaps NAD successfully
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Previously hotplugged interface swaps NAD successfully
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Previously hotplugged interface swaps NAD successfully
    condition: 'Expected: Previously hotplugged interface swaps NAD successfully'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.8
  test_id: TS-CNV-72329-023
  tier: Tier 2
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Rollback NAD change before migration completes
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should migration cancels or uses original nad if already started
      test_id_format: '[test_id:TS-CNV-72329-023]'
  test_objective:
    title: Rollback NAD change before migration completes
    what: Validate that rollback nad change before migration completes. Migration cancels or uses original NAD if already
      started
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Migration cancels or uses original NAD if already started
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Migration cancels or uses original NAD if already started
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Migration cancels or uses original NAD if already started
    condition: 'Expected: Migration cancels or uses original NAD if already started'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.9
  test_id: TS-CNV-72329-024
  tier: Tier 2
  priority: P2
  mvp: false
  automated: Partial
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with concurrent VM updates
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should nad change processed correctly alongside other updates
      test_id_format: '[test_id:TS-CNV-72329-024]'
  test_objective:
    title: NAD swap with concurrent VM updates
    what: Validate that nad swap with concurrent vm updates. NAD change processed correctly alongside other updates
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - NAD change processed correctly alongside other updates
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: NAD change processed correctly alongside other updates
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: NAD change processed correctly alongside other updates
    condition: 'Expected: NAD change processed correctly alongside other updates'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.10
  test_id: TS-CNV-72329-025
  tier: Tier 2
  priority: P1
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD on VM with running workload
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should workload experiences expected network interruption, recovers
      test_id_format: '[test_id:TS-CNV-72329-025]'
  test_objective:
    title: Change NAD on VM with running workload
    what: Validate that change nad on vm with running workload. Workload experiences expected network interruption, recovers
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Workload experiences expected network interruption, recovers
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Workload experiences expected network interruption, recovers
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Workload experiences expected network interruption, recovers
    condition: 'Expected: Workload experiences expected network interruption, recovers'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.11
  test_id: TS-CNV-72329-026
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with different bridge configuration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm connects to different bridge (br1  br2) successfully
      test_id_format: '[test_id:TS-CNV-72329-026]'
  test_objective:
    title: NAD swap with different bridge configuration
    what: Validate that nad swap with different bridge configuration. VM connects to different bridge (br1  br2) successfully
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM connects to different bridge (br1  br2) successfully
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM connects to different bridge (br1  br2) successfully
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: VM connects to different bridge (br1  br2) successfully
    condition: 'Expected: VM connects to different bridge (br1  br2) successfully'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.12
  test_id: TS-CNV-72329-027
  tier: Tier 2
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify Dynamic Networks Controller compatibility
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should dnc does not interfere with migration-based nad swap
      test_id_format: '[test_id:TS-CNV-72329-027]'
  test_objective:
    title: Verify Dynamic Networks Controller compatibility
    what: Validate that verify dynamic networks controller compatibility. DNC does not interfere with migration-based NAD
      swap
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - DNC does not interfere with migration-based NAD swap
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: DNC does not interfere with migration-based NAD swap
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: DNC does not interfere with migration-based NAD swap
    condition: 'Expected: DNC does not interfere with migration-based NAD swap'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.13
  test_id: TS-CNV-72329-028
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD change on VM with persistent volumes
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should vm migrates with pvs, nad swap succeeds
      test_id_format: '[test_id:TS-CNV-72329-028]'
  test_objective:
    title: NAD change on VM with persistent volumes
    what: Validate that nad change on vm with persistent volumes. VM migrates with PVs, NAD swap succeeds
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - VM migrates with PVs, NAD swap succeeds
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: VM migrates with PVs, NAD swap succeeds
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: VM migrates with PVs, NAD swap succeeds
    condition: 'Expected: VM migrates with PVs, NAD swap succeeds'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.14
  test_id: TS-CNV-72329-029
  tier: Tier 2
  priority: P3
  mvp: false
  automated: Manual
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Monitor migration performance impact
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should nad swap migration completes within expected time window
      test_id_format: '[test_id:TS-CNV-72329-029]'
  test_objective:
    title: Monitor migration performance impact
    what: Validate that monitor migration performance impact. NAD swap migration completes within expected time window
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - NAD swap migration completes within expected time window
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: NAD swap migration completes within expected time window
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P3
    description: NAD swap migration completes within expected time window
    condition: 'Expected: NAD swap migration completes within expected time window'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.15
  test_id: TS-CNV-72329-030
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with network policy applied
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should network policy applies correctly to new nad
      test_id_format: '[test_id:TS-CNV-72329-030]'
  test_objective:
    title: NAD swap with network policy applied
    what: Validate that nad swap with network policy applied. Network policy applies correctly to new NAD
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Network policy applies correctly to new NAD
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Network policy applies correctly to new NAD
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Network policy applies correctly to new NAD
    condition: 'Expected: Network policy applies correctly to new NAD'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.16
  test_id: TS-CNV-72329-031
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD back to original network
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should reverse nad swap (aba) works correctly
      test_id_format: '[test_id:TS-CNV-72329-031]'
  test_objective:
    title: Change NAD back to original network
    what: Validate that change nad back to original network. Reverse NAD swap (ABA) works correctly
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Reverse NAD swap (ABA) works correctly
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Reverse NAD swap (ABA) works correctly
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Reverse NAD swap (ABA) works correctly
    condition: 'Expected: Reverse NAD swap (ABA) works correctly'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.17
  test_id: TS-CNV-72329-032
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with IPv4 and IPv6 networks
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should both ip stacks work correctly after migration
      test_id_format: '[test_id:TS-CNV-72329-032]'
  test_objective:
    title: NAD swap with IPv4 and IPv6 networks
    what: Validate that nad swap with ipv4 and ipv6 networks. Both IP stacks work correctly after migration
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Both IP stacks work correctly after migration
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Both IP stacks work correctly after migration
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Both IP stacks work correctly after migration
    condition: 'Expected: Both IP stacks work correctly after migration'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.18
  test_id: TS-CNV-72329-033
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify virt-controller RestartRequired logic
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should controller correctly identifies nad-only changes
      test_id_format: '[test_id:TS-CNV-72329-033]'
  test_objective:
    title: Verify virt-controller RestartRequired logic
    what: Validate that verify virt-controller restartrequired logic. Controller correctly identifies NAD-only changes
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Controller correctly identifies NAD-only changes
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Controller correctly identifies NAD-only changes
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Controller correctly identifies NAD-only changes
    condition: 'Expected: Controller correctly identifies NAD-only changes'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.19
  test_id: TS-CNV-72329-034
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify virt-controller network sync logic
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should controller syncs networkname field from vm to vmi
      test_id_format: '[test_id:TS-CNV-72329-034]'
  test_objective:
    title: Verify virt-controller network sync logic
    what: Validate that verify virt-controller network sync logic. Controller syncs networkName field from VM to VMI
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Controller syncs networkName field from VM to VMI
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Controller syncs networkName field from VM to VMI
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Controller syncs networkName field from VM to VMI
    condition: 'Expected: Controller syncs networkName field from VM to VMI'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T2.20
  test_id: TS-CNV-72329-035
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify WorkloadUpdateController migration logic
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should controller requests immediate migration for bridge binding
      test_id_format: '[test_id:TS-CNV-72329-035]'
  test_objective:
    title: Verify WorkloadUpdateController migration logic
    what: Validate that verify workloadupdatecontroller migration logic. Controller requests immediate migration for bridge
      binding
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Controller requests immediate migration for bridge binding
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Controller requests immediate migration for bridge binding
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Controller requests immediate migration for bridge binding
    condition: 'Expected: Controller requests immediate migration for bridge binding'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N1
  test_id: TS-CNV-72329-036
  tier: Negative
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD binding type (bridge  SR-IOV)
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should restartrequired condition added, no migration
      test_id_format: '[test_id:TS-CNV-72329-036]'
  test_objective:
    title: Change NAD binding type (bridge  SR-IOV)
    what: Validate that change nad binding type (bridge  sr-iov). RestartRequired condition added, no migration
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - RestartRequired condition added, no migration
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: RestartRequired condition added, no migration
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: RestartRequired condition added, no migration
    condition: 'Expected: RestartRequired condition added, no migration'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N2
  test_id: TS-CNV-72329-037
  tier: Negative
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD on non-migratable VM
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should error or restartrequired condition, no migration attempted
      test_id_format: '[test_id:TS-CNV-72329-037]'
  test_objective:
    title: Change NAD on non-migratable VM
    what: Validate that change nad on non-migratable vm. Error or RestartRequired condition, no migration attempted
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Error or RestartRequired condition, no migration attempted
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Error or RestartRequired condition, no migration attempted
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Error or RestartRequired condition, no migration attempted
    condition: 'Expected: Error or RestartRequired condition, no migration attempted'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N3
  test_id: TS-CNV-72329-038
  tier: Negative
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Target NAD deleted during migration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should migration fails gracefully, vm remains functional on source
      test_id_format: '[test_id:TS-CNV-72329-038]'
  test_objective:
    title: Target NAD deleted during migration
    what: Validate that target nad deleted during migration. Migration fails gracefully, VM remains functional on source
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Migration fails gracefully, VM remains functional on source
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Migration fails gracefully, VM remains functional on source
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Migration fails gracefully, VM remains functional on source
    condition: 'Expected: Migration fails gracefully, VM remains functional on source'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N4
  test_id: TS-CNV-72329-039
  tier: Negative
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD with insufficient node resources
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should migration fails with scheduling error, clear message
      test_id_format: '[test_id:TS-CNV-72329-039]'
  test_objective:
    title: Change NAD with insufficient node resources
    what: Validate that change nad with insufficient node resources. Migration fails with scheduling error, clear message
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Migration fails with scheduling error, clear message
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Migration fails with scheduling error, clear message
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Migration fails with scheduling error, clear message
    condition: 'Expected: Migration fails with scheduling error, clear message'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N5
  test_id: TS-CNV-72329-040
  tier: Negative
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with incompatible CNI plugin
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should validation rejects change or migration fails with clear error
      test_id_format: '[test_id:TS-CNV-72329-040]'
  test_objective:
    title: NAD swap with incompatible CNI plugin
    what: Validate that nad swap with incompatible cni plugin. Validation rejects change or migration fails with clear error
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Validation rejects change or migration fails with clear error
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Validation rejects change or migration fails with clear error
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Validation rejects change or migration fails with clear error
    condition: 'Expected: Validation rejects change or migration fails with clear error'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N6
  test_id: TS-CNV-72329-041
  tier: Negative
  priority: P3
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD on paused VM
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should nad change queued, processed when vm unpaused
      test_id_format: '[test_id:TS-CNV-72329-041]'
  test_objective:
    title: Change NAD on paused VM
    what: Validate that change nad on paused vm. NAD change queued, processed when VM unpaused
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - NAD change queued, processed when VM unpaused
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: NAD change queued, processed when VM unpaused
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P3
    description: NAD change queued, processed when VM unpaused
    condition: 'Expected: NAD change queued, processed when VM unpaused'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N7
  test_id: TS-CNV-72329-042
  tier: Negative
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Rapidly toggle NAD reference multiple times
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should system handles rapid changes without corruption
      test_id_format: '[test_id:TS-CNV-72329-042]'
  test_objective:
    title: Rapidly toggle NAD reference multiple times
    what: Validate that rapidly toggle nad reference multiple times. System handles rapid changes without corruption
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - System handles rapid changes without corruption
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: System handles rapid changes without corruption
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: System handles rapid changes without corruption
    condition: 'Expected: System handles rapid changes without corruption'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N8
  test_id: TS-CNV-72329-043
  tier: Negative
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD with namespace mismatch
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should validation error or migration failure with clear message
      test_id_format: '[test_id:TS-CNV-72329-043]'
  test_objective:
    title: Change NAD with namespace mismatch
    what: Validate that change nad with namespace mismatch. Validation error or migration failure with clear message
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Validation error or migration failure with clear message
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Validation error or migration failure with clear message
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Validation error or migration failure with clear message
    condition: 'Expected: Validation error or migration failure with clear message'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N9
  test_id: TS-CNV-72329-044
  tier: Negative
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Target NAD has invalid configuration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should migration fails with validation error
      test_id_format: '[test_id:TS-CNV-72329-044]'
  test_objective:
    title: Target NAD has invalid configuration
    what: Validate that target nad has invalid configuration. Migration fails with validation error
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Migration fails with validation error
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Migration fails with validation error
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Migration fails with validation error
    condition: 'Expected: Migration fails with validation error'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: N10
  test_id: TS-CNV-72329-045
  tier: Negative
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: migration-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Change NAD during active migration
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should change queued or rejected with appropriate error
      test_id_format: '[test_id:TS-CNV-72329-045]'
  test_objective:
    title: Change NAD during active migration
    what: Validate that change nad during active migration. Change queued or rejected with appropriate error
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Change queued or rejected with appropriate error
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Change queued or rejected with appropriate error
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Change queued or rejected with appropriate error
    condition: 'Expected: Change queued or rejected with appropriate error'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P1
  test_id: TS-CNV-72329-046
  tier: Platform
  priority: P0
  mvp: true
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap on x86_64 platform
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature works on x86_64 nodes
      test_id_format: '[test_id:TS-CNV-72329-046]'
  test_objective:
    title: NAD swap on x86_64 platform
    what: Validate that nad swap on x86_64 platform. Feature works on x86_64 nodes
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature works on x86_64 nodes
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature works on x86_64 nodes
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P0
    description: Feature works on x86_64 nodes
    condition: 'Expected: Feature works on x86_64 nodes'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P2
  test_id: TS-CNV-72329-047
  tier: Platform
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap on ARM64 platform
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature works on arm64 nodes
      test_id_format: '[test_id:TS-CNV-72329-047]'
  test_objective:
    title: NAD swap on ARM64 platform
    what: Validate that nad swap on arm64 platform. Feature works on ARM64 nodes
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature works on ARM64 nodes
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature works on ARM64 nodes
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Feature works on ARM64 nodes
    condition: 'Expected: Feature works on ARM64 nodes'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P3
  test_id: TS-CNV-72329-048
  tier: Platform
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap on s390x platform (if applicable)
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature works on s390x nodes
      test_id_format: '[test_id:TS-CNV-72329-048]'
  test_objective:
    title: NAD swap on s390x platform (if applicable)
    what: Validate that nad swap on s390x platform (if applicable). Feature works on s390x nodes
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature works on s390x nodes
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature works on s390x nodes
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Feature works on s390x nodes
    condition: 'Expected: Feature works on s390x nodes'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P4
  test_id: TS-CNV-72329-049
  tier: Platform
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with OVN-Kubernetes CNI
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should works correctly with ovn-k
      test_id_format: '[test_id:TS-CNV-72329-049]'
  test_objective:
    title: NAD swap with OVN-Kubernetes CNI
    what: Validate that nad swap with ovn-kubernetes cni. Works correctly with OVN-K
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Works correctly with OVN-K
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Works correctly with OVN-K
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Works correctly with OVN-K
    condition: 'Expected: Works correctly with OVN-K'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P5
  test_id: TS-CNV-72329-050
  tier: Platform
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: NAD swap with OpenShiftSDN (if supported)
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should works correctly with openshiftsdn
      test_id_format: '[test_id:TS-CNV-72329-050]'
  test_objective:
    title: NAD swap with OpenShiftSDN (if supported)
    what: Validate that nad swap with openshiftsdn (if supported). Works correctly with OpenShiftSDN
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Works correctly with OpenShiftSDN
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Works correctly with OpenShiftSDN
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Works correctly with OpenShiftSDN
    condition: 'Expected: Works correctly with OpenShiftSDN'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P6
  test_id: TS-CNV-72329-051
  tier: Platform
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Baremetal deployment NAD swap
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature works on baremetal clusters
      test_id_format: '[test_id:TS-CNV-72329-051]'
  test_objective:
    title: Baremetal deployment NAD swap
    what: Validate that baremetal deployment nad swap. Feature works on baremetal clusters
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature works on baremetal clusters
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature works on baremetal clusters
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Feature works on baremetal clusters
    condition: 'Expected: Feature works on baremetal clusters'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P7
  test_id: TS-CNV-72329-052
  tier: Platform
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: IPI deployment NAD swap
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature works on ipi clusters
      test_id_format: '[test_id:TS-CNV-72329-052]'
  test_objective:
    title: IPI deployment NAD swap
    what: Validate that ipi deployment nad swap. Feature works on IPI clusters
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature works on IPI clusters
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature works on IPI clusters
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: Feature works on IPI clusters
    condition: 'Expected: Feature works on IPI clusters'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: P8
  test_id: TS-CNV-72329-053
  tier: Platform
  priority: P2
  mvp: false
  automated: Manual
  patterns:
    primary: network-nad-swap-001
    secondary: []
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference live update tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: UPI deployment NAD swap
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should feature works on upi clusters
      test_id_format: '[test_id:TS-CNV-72329-053]'
  test_objective:
    title: UPI deployment NAD swap
    what: Validate that upi deployment nad swap. Feature works on UPI clusters
    why: Ensure NAD reference can be updated on running VMs without VM restart, enabling network VLAN changes through live
      migration.
    acceptance_criteria:
    - Feature works on UPI clusters
    - VM remains running throughout the operation
    - No data loss or service interruption beyond expected migration window
  classification:
    test_type: Integration
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-swap
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-03
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference target NAD
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered automatically
      command: Check for VMI migration in progress
      validation: Migration initiated, no RestartRequired condition
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify target pod has updated NAD annotation
      command: Check pod multus annotation
      validation: Feature works on UPI clusters
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: Feature works on UPI clusters
    condition: 'Expected: Feature works on UPI clusters'
    failure_impact: Feature does not work as expected for this scenario
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    external_tools: []
    scenario_specific_rbac:
    - manage NADs
    - manage VMs
    - trigger migrations
  estimated_execution_time: 3 minutes
- scenario_id: T1.16
  test_id: TS-CNV-72329-054
  tier: Tier 1
  priority: P1
  mvp: true
  automated: 'Yes'
  patterns:
    primary: rbac-authorization-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
    - name: authorizedClient
      type: kubecli.KubevirtClient
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Client with VM edit permissions
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference RBAC authorization tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify authorized user can change NAD reference
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should allow authorized user to swap NAD successfully
      test_id_format: '[test_id:TS-CNV-72329-054]'
  test_objective:
    title: Verify authorized user can change NAD reference
    what: Validate that user with VM edit permissions can swap NAD successfully. User with VM edit permissions can swap NAD successfully
    why: Ensure proper RBAC enforcement for NAD swap operations, confirming authorized users can perform network changes.
    acceptance_criteria:
    - User with VM edit permissions can swap NAD successfully
    - NAD swap operation completes without authorization errors
    - Migration triggered as expected for authorized user
  classification:
    test_type: E2E
    scope: Single-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-rbac
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create service account with VM edit permissions
      command: Create ServiceAccount with edit role binding
      validation: ServiceAccount created with proper RBAC
    - step_id: SETUP-03
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-04
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Authenticate as authorized service account
      command: Get client credentials for authorized service account
      validation: Authentication successful
    - step_id: TEST-02
      action: Update VM spec to reference target NAD as authorized user
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM spec updated successfully without authorization error
    - step_id: TEST-03
      action: Verify migration triggered
      command: Check for VMI migration in progress
      validation: Migration initiated as expected
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs and service account
      command: oc delete nad,sa --all
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: User with VM edit permissions can swap NAD successfully
    condition: 'Expected: User with VM edit permissions can swap NAD successfully'
    failure_impact: RBAC enforcement failure - security vulnerability
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    - ServiceAccount
    - RoleBinding
    external_tools: []
    scenario_specific_rbac:
    - VM edit permissions
    - NAD management
  estimated_execution_time: 4 minutes
- scenario_id: T1.17
  test_id: TS-CNV-72329-055
  tier: Tier 1
  priority: P1
  mvp: true
  automated: 'Yes'
  patterns:
    primary: rbac-authorization-002
    secondary:
    - factory-001
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    decorators:
    - decorators.Tier1
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Target NAD for swap
    - name: unauthorizedClient
      type: kubecli.KubevirtClient
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Client without VM edit permissions
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: NAD reference RBAC denial tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Verify unauthorized user cannot change NAD reference
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should reject unauthorized user with proper authorization error
      test_id_format: '[test_id:TS-CNV-72329-055]'
  test_objective:
    title: Verify unauthorized user cannot change NAD reference
    what: Validate that user without permissions receives proper authorization error. User without permissions receives proper authorization error
    why: Ensure proper RBAC enforcement prevents unauthorized network configuration changes, maintaining security boundaries.
    acceptance_criteria:
    - User without permissions receives proper authorization error
    - VM spec remains unchanged after unauthorized attempt
    - No migration triggered for unauthorized request
  classification:
    test_type: E2E
    scope: Single-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-rbac-deny
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-02
      action: Create service account without VM edit permissions
      command: Create ServiceAccount with read-only role binding
      validation: ServiceAccount created with restricted RBAC
    - step_id: SETUP-03
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-04
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with correct NAD attachment
    test_execution:
    - step_id: TEST-01
      action: Authenticate as unauthorized service account
      command: Get client credentials for unauthorized service account
      validation: Authentication successful but permissions limited
    - step_id: TEST-02
      action: Attempt to update VM spec to reference target NAD as unauthorized user
      command: Try to patch VM spec.networks[].multus.networkName to target NAD
      validation: Request rejected with authorization error (403 Forbidden)
    - step_id: TEST-03
      action: Verify VM spec unchanged
      command: Check VM spec still references original NAD
      validation: VM configuration unchanged after unauthorized attempt
    - step_id: TEST-04
      action: Verify no migration triggered
      command: Check VMI status for migration events
      validation: No migration initiated
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs and service account
      command: oc delete nad,sa --all
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: User without permissions receives proper authorization error
    condition: 'Expected: User without permissions receives proper authorization error'
    failure_impact: RBAC enforcement failure - security vulnerability
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    - ServiceAccount
    - RoleBinding
    external_tools: []
    scenario_specific_rbac:
    - Limited/no VM edit permissions
  estimated_execution_time: 3 minutes
- scenario_id: T2.21
  test_id: TS-CNV-72329-056
  tier: Tier 2
  priority: P1
  mvp: false
  automated: 'Yes'
  patterns:
    primary: upgrade-persistence-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadOriginal
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Original NAD
    - name: nadTarget
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: Target NAD for swap
    - name: originalNADName
      type: string
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Original NAD name for comparison
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: CNV upgrade with swapped NAD persistence tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: CNV upgrade with VM using swapped NAD
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should persist swapped NAD configuration post-upgrade
      test_id_format: '[test_id:TS-CNV-72329-056]'
  test_objective:
    title: CNV upgrade with VM using swapped NAD
    what: Validate that cnv upgrade with vm using swapped nad. VM persists with swapped NAD configuration post-upgrade
    why: Ensure VMs with swapped NAD configurations survive CNV upgrades without data loss or configuration reversion.
    acceptance_criteria:
    - VM persists with swapped NAD configuration post-upgrade
    - VM remains running or restarts cleanly after upgrade
    - Network connectivity maintained through new NAD post-upgrade
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Record current CNV version
      command: oc get csv -n openshift-cnv | grep kubevirt-hyperconverged
      validation: CNV version recorded
    - step_id: SETUP-02
      action: Create test namespace and enable feature gate
      command: oc create namespace test-nad-upgrade
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled
    - step_id: SETUP-03
      action: Create original and target NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-04
      action: Create VM with bridge binding to original NAD
      command: Create VM with spec.networks referencing original NAD
      validation: VM running with original NAD
    - step_id: SETUP-05
      action: Perform NAD swap from original to target
      command: Patch VM spec.networks[].multus.networkName to target NAD
      validation: VM migrated to target NAD successfully
    - step_id: SETUP-06
      action: Verify VM using target NAD before upgrade
      command: Check VM spec and pod annotations
      validation: VM using target NAD, not original
    test_execution:
    - step_id: TEST-01
      action: Trigger CNV upgrade to next minor version
      command: Update HCO subscription or CSV
      validation: Upgrade initiated
    - step_id: TEST-02
      action: Wait for CNV upgrade to complete
      command: Monitor HCO conditions and CSV status
      validation: Upgrade completed successfully
    - step_id: TEST-03
      action: Verify VM still running or restarted cleanly
      command: Check VM and VMI status
      validation: VM in Running state
    - step_id: TEST-04
      action: Verify VM still using swapped NAD (target)
      command: Check VM spec.networks and pod annotations
      validation: VM persists with swapped NAD configuration post-upgrade
    - step_id: TEST-05
      action: Verify network connectivity through target NAD
      command: Test network connectivity from VM
      validation: Network functional through target NAD
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad original-nad target-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P1
    description: VM persists with swapped NAD configuration post-upgrade
    condition: 'Expected: VM persists with swapped NAD configuration post-upgrade'
    failure_impact: Data loss or configuration reversion during upgrade - critical upgrade path issue
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    - HyperConverged
    - ClusterServiceVersion
    external_tools:
    - CNV upgrade mechanism
    scenario_specific_rbac:
    - CNV upgrade permissions
    - VM management
    - NAD management
  estimated_execution_time: 30 minutes
- scenario_id: T2.22
  test_id: TS-CNV-72329-057
  tier: Tier 2
  priority: P2
  mvp: false
  automated: 'Yes'
  patterns:
    primary: upgrade-functionality-001
    secondary:
    - factory-001
    - wait-002
    helpers_required:
    - name: libvmifact
      functions:
      - NewFedora
      purpose: VM factory
    - name: libnet
      functions:
      - CreateNetworkAttachmentDefinition
      purpose: NAD management
    - name: libwait
      functions:
      - WaitUntilVMIReady
      purpose: Wait for resources
    - name: libmigration
      functions:
      - MigrateVMI
      purpose: Live migration operations
    decorators:
    - decorators.Tier2
    - decorators.SigNetwork
    - Serial
  variables:
    closure_scope:
    - name: ctx
      type: context.Context
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Context for K8s API calls
    - name: namespace
      type: string
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - AfterEach
      comment: Test namespace
    - name: err
      type: error
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Error variable for API calls
    - name: vmi
      type: '*v1.VirtualMachineInstance'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      - AfterEach
      comment: Test VM instance
    - name: nadFirst
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - BeforeAll
      - It
      comment: First NAD
    - name: nadSecond
      type: '*networkv1.NetworkAttachmentDefinition'
      initialized_in: BeforeAll
      used_in:
      - It
      comment: Second NAD for post-upgrade swap
  test_structure:
    type: single
    describe:
      wrapper: SIG
      description: Post-CNV upgrade NAD swap functionality tests
      decorators:
      - decorators.SigNetwork
      - Serial
    context:
      description: Post-upgrade NAD swap operation
      decorators:
      - Ordered
      - decorators.OncePerOrderedCleanup
    it:
      description: should allow NAD swap after CNV upgrade completes
      test_id_format: '[test_id:TS-CNV-72329-057]'
  test_objective:
    title: Post-upgrade NAD swap operation
    what: Validate that post-upgrade nad swap operation. VM can perform new NAD swap after CNV upgrade completes
    why: Ensure NAD swap functionality remains operational after CNV upgrades, confirming feature persistence across versions.
    acceptance_criteria:
    - VM can perform new NAD swap after CNV upgrade completes
    - Migration triggered as expected post-upgrade
    - Network connectivity established through new NAD
  classification:
    test_type: E2E
    scope: Multi-component
    automation_approach: ginkgo/gomega with KubeVirt test framework
  test_steps:
    setup:
    - step_id: SETUP-01
      action: Record current CNV version
      command: oc get csv -n openshift-cnv | grep kubevirt-hyperconverged
      validation: CNV version recorded
    - step_id: SETUP-02
      action: Trigger CNV upgrade to next minor version
      command: Update HCO subscription or CSV
      validation: Upgrade initiated
    - step_id: SETUP-03
      action: Wait for CNV upgrade to complete
      command: Monitor HCO conditions and CSV status
      validation: Upgrade completed successfully
    - step_id: SETUP-04
      action: Create test namespace and verify feature gate enabled
      command: oc create namespace test-nad-post-upgrade
      validation: Namespace exists, LiveUpdateNADRef feature gate enabled post-upgrade
    - step_id: SETUP-05
      action: Create two NAD definitions
      command: Apply NAD YAML with different VLAN configurations
      validation: NADs created successfully
    - step_id: SETUP-06
      action: Create VM with bridge binding to first NAD
      command: Create VM with spec.networks referencing first NAD
      validation: VM running with first NAD
    test_execution:
    - step_id: TEST-01
      action: Update VM spec to reference second NAD
      command: Patch VM spec.networks[].multus.networkName to second NAD
      validation: VM spec updated successfully
    - step_id: TEST-02
      action: Verify migration triggered
      command: Check for VMI migration in progress
      validation: Migration initiated as expected
    - step_id: TEST-03
      action: Wait for migration to complete
      command: Wait for VMI to reach Running state on target pod
      validation: Migration completed successfully
    - step_id: TEST-04
      action: Verify VM using second NAD post-swap
      command: Check VM spec and pod annotations
      validation: VM can perform new NAD swap after CNV upgrade completes
    - step_id: TEST-05
      action: Verify network connectivity through second NAD
      command: Test network connectivity from VM
      validation: Network functional through second NAD
    cleanup:
    - step_id: CLEANUP-01
      action: Delete VM
      command: oc delete vm test-vm
    - step_id: CLEANUP-02
      action: Delete NADs
      command: oc delete nad first-nad second-nad
  assertions:
  - assertion_id: ASSERT-01
    priority: P2
    description: VM can perform new NAD swap after CNV upgrade completes
    condition: 'Expected: VM can perform new NAD swap after CNV upgrade completes'
    failure_impact: Feature broken after upgrade - upgrade regression
  dependencies:
    kubernetes_resources:
    - VirtualMachine
    - NetworkAttachmentDefinition
    - HyperConverged
    - ClusterServiceVersion
    external_tools:
    - CNV upgrade mechanism
    scenario_specific_rbac:
    - CNV upgrade permissions
    - VM management
    - NAD management
  estimated_execution_time: 35 minutes

